{% extends "base.html" %}
{% set title = "AI News Feed" %}

{% block extra_head %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}?v={{ cache_bust }}">

<style>
  /* Robust multi-line clamp with a fallback */
  .line-clamp-4 {
    /* primary clamp */
    display: -webkit-box !important;
    -webkit-box-orient: vertical;
    -webkit-line-clamp: 4;
    overflow: hidden !important;
    white-space: normal !important;   /* override any pre-wrap from global CSS */
  }
  /* Fallback when -webkit-line-clamp isn't supported */
  @supports not (-webkit-line-clamp: 1) {
    .line-clamp-4 {
      display: block !important;
      line-height: 1.25rem;
      max-height: calc(1.25rem * 4);
    }
  }
</style>
{% endblock %}

{% block content %}
  <h1 class="mb-4">Top Stories in AI</h1>

  <div id="news-container" class="row g-4">
    {% for item in news_items %}
      <div class="col-md-6 story">
        <div class="card h-100">
          <div class="card-body">
            <!-- Titles -->
            <h5 class="card-title">
              {{ (item.title.fr if current_lang=='FR' else item.title.en) }}
            </h5>

            <p class="card-text summary">
              {{ (item.summary.fr if current_lang=='FR' else item.summary.en) | preview(380) }}
            </p>


            <a href="{{ item.url }}" class="btn btn-primary mt-1" target="_blank" rel="noopener">Read more</a>

            <!-- Badges -->
            <div class="mt-2">
              {% set has_finance = (item.tags is defined and item.tags and 'finance' in item.tags) or ('finance' in (item.categories or [])) %}
              {% if has_finance %}
                <span class="badge bg-secondary me-1">Finance</span>
              {% endif %}
              {% for category in item.categories %}
                {% if not (has_finance and (category|lower == 'finance')) %}
                  <span class="badge bg-secondary">{{ category }}</span>
                {% endif %}
              {% endfor %}
            </div>
          </div>
        </div>
      </div>
    {% endfor %}
  </div>
{% endblock %}

{% block page_scripts %}
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <script src="{{ url_for('static', filename='js/main.js') }}"></script>
  <script>
    // EN/FR switch (kept for when FR returns)
    document.addEventListener("DOMContentLoaded", () => {
      const lang = localStorage.getItem("lang") || "EN";
      setLanguage(lang);
    });
    function setLanguage(lang) {
      const sel = document.getElementById("selected-lang");
      if (sel) sel.textContent = lang;
      document.querySelectorAll(".story").forEach(story => {
        story.querySelectorAll(".story-en").forEach(el => el.style.display = (lang === "EN") ? "block" : "none");
        story.querySelectorAll(".story-fr").forEach(el => el.style.display = (lang === "FR") ? "block" : "none");
      });
    }
  </script>
{% endblock %}
